(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/upload/upload"],{"01dd":function(t,e,o){"use strict";var n=o("dab6"),i=o.n(n);i.a},"242a":function(t,e,o){"use strict";o("fb50");var n=c(o("b0ce")),i=c(o("a98c"));function c(t){return t&&t.__esModule?t:{default:t}}Page((0,n.default)(i.default))},"697e":function(t,e,o){"use strict";(function(e){(function(e,o){t.exports=o()})(0,function(){var t=void 0,o=["touchstarted","touchmoved","touchended"];function n(t){return t.charAt(0).toUpperCase()+t.slice(1)}function i(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];o.forEach(function(e,o){void 0!==n[o]&&(t[e]=n[o])})}function c(t,e){Object.defineProperties(t,e)}function r(){return t||(t=wx.getSystemInfoSync()),t}"function"===typeof Symbol&&Symbol.iterator;var a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),s=function(){function t(t,e){var o=[],n=!0,i=!1,c=void 0;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done);n=!0)if(o.push(r.value),e&&o.length===e)break}catch(u){i=!0,c=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw c}}return o}return function(e,o){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l={},d={id:{default:"cropper",get:function(){return l.id},set:function(t){l.id=t}},width:{default:750,get:function(){return l.width},set:function(t){l.width=t}},height:{default:750,get:function(){return l.height},set:function(t){l.height=t}},scale:{default:2.5,get:function(){return l.scale},set:function(t){l.scale=t}},zoom:{default:5,get:function(){return l.zoom},set:function(t){l.zoom=t}},src:{default:"cropper",get:function(){return l.src},set:function(t){l.src=t}},cut:{default:{},get:function(){return l.cut},set:function(t){l.cut=t}},onReady:{default:null,get:function(){return l.ready},set:function(t){l.ready=t}},onBeforeImageLoad:{default:null,get:function(){return l.beforeImageLoad},set:function(t){l.beforeImageLoad=t}},onImageLoad:{default:null,get:function(){return l.imageLoad},set:function(t){l.imageLoad=t}},onBeforeDraw:{default:null,get:function(){return l.beforeDraw},set:function(t){l.beforeDraw=t}}};function f(){var t=this,e=r(),o=e.windowWidth;t.attachPage=function(){var e=getCurrentPages(),o=e[e.length-1];o.wecropper=t},t.createCtx=function(){var e=t.id;e&&(t.ctx=wx.createCanvasContext(e))},t.deviceRadio=o/750,t.deviceRadio=t.deviceRadio.toFixed(2)}function h(){var t=this,e=["ready","beforeImageLoad","beforeDraw","imageLoad"];t.on=function(o,i){return e.indexOf(o)>-1&&"function"===typeof i&&("ready"===o?i(t):t["on"+n(o)]=i),t}}function p(){var t=this,o=t.deviceRadio;console.log(JSON.stringify(t));var n=t.width,i=t.height,c=t.cut,r=c.x,a=void 0===r?0:r,u=c.y,s=void 0===u?0:u,l=c.width,d=void 0===l?n:l,f=c.height,h=void 0===f?i:f;t.updateCanvas=function(){return t.croperTarget&&t.ctx.drawImage(t.croperTarget,t.imgLeft,t.imgTop,t.scaleWidth,t.scaleHeight),"function"===typeof t.onBeforeDraw&&t.onBeforeDraw(t.ctx,t),t.setBoundStyle(),t.ctx.draw(),t},t.pushOrign=function(o){return t.src=o,"function"===typeof t.onBeforeImageLoad&&t.onBeforeImageLoad(t.ctx,t),e.getImageInfo({src:o,success:function(e){var n=e.width/e.height;t.croperTarget=e.path||o,n<d/h?(t.rectX=a,t.baseWidth=d,t.baseHeight=d/n,t.rectY=s-Math.abs((h-t.baseHeight)/2)):(t.rectY=s,t.baseWidth=h*n,t.baseHeight=h,t.rectX=a-Math.abs((d-t.baseWidth)/2)),t.imgLeft=t.rectX,t.imgTop=t.rectY,t.scaleWidth=t.baseWidth,t.scaleHeight=t.baseHeight,t.updateCanvas(),"function"===typeof t.onImageLoad&&t.onImageLoad(t.ctx,t)}}),t.update(),t},t.getCropperImage=function(){for(var n=arguments.length,i=Array(n),c=0;c<n;c++)i[c]=arguments[c];var r=t.id,u=toString.call(i[0]);switch(u){case"[object Object]":var l=i[0].quality,f=void 0===l?10:l;console.log("quality--"+f),e.canvasToTempFilePath({canvasId:r,x:a,y:s,width:d,height:h,destWidth:d*f/(10*o),destHeight:h*f/(10*o),success:function(t){console.log(t),"function"===typeof i[i.length-1]&&i[i.length-1](t.tempFilePath)}});break;case"[object Function]":e.canvasToTempFilePath({canvasId:r,x:a,y:s,fileType:"jpg",width:d,height:h,destWidth:d,destHeight:h,success:function(t){"function"===typeof i[i.length-1]&&i[i.length-1](t.tempFilePath)}});break}return t}}function g(){var t=this;t.src&&(t.__oneTouchStart=function(e){t.touchX0=e.x,t.touchY0=e.y},t.__oneTouchMove=function(e){var o=void 0,n=void 0;if(t.touchended)return t.updateCanvas();o=e.x-t.touchX0,n=e.y-t.touchY0;var i=t.rectX+o,c=t.rectY+n;t.outsideBound(i,c),t.updateCanvas()},t.__twoTouchStart=function(e,o){var n=void 0,i=void 0,c=void 0;t.touchX1=t.rectX+t.scaleWidth/2,t.touchY1=t.rectY+t.scaleHeight/2,n=o.x-e.x,i=o.y-e.y,c=Math.sqrt(n*n+i*i),t.oldDistance=c},t.__twoTouchMove=function(e,o){var n=void 0,i=void 0,c=void 0,r=t.scale,a=t.zoom;n=o.x-e.x,i=o.y-e.y,c=Math.sqrt(n*n+i*i),t.newScale=t.oldScale+.001*a*(c-t.oldDistance),t.newScale<=1&&(t.newScale=1),t.newScale>=r&&(t.newScale=r),t.scaleWidth=t.newScale*t.baseWidth,t.scaleHeight=t.newScale*t.baseHeight;var u=t.touchX1-t.scaleWidth/2,s=t.touchY1-t.scaleHeight/2;t.outsideBound(u,s),t.updateCanvas()},t.__xtouchEnd=function(){t.oldScale=t.newScale,t.rectX=t.imgLeft,t.rectY=t.imgTop})}var v={touchStart:function(t){var e=this,o=s(t.touches,2),n=o[0],c=o[1];console.log(JSON.stringify(c)),n.x||(n.x=n.clientX,n.y=n.clientY,c&&(c.x=c.clientX,c.y=c.clientY)),i(e,!0,null,null),e.__oneTouchStart(n),t.touches.length>=2&&e.__twoTouchStart(n,c)},touchMove:function(t){var e=this,o=s(t.touches,2),n=o[0],c=o[1];n.x||(n.x=n.clientX,n.y=n.clientY,c&&(c.x=c.clientX,c.y=c.clientY)),i(e,null,!0),1===t.touches.length&&e.__oneTouchMove(n),t.touches.length>=2&&e.__twoTouchMove(n,c)},touchEnd:function(t){var e=this;i(e,!1,!1,!0),e.__xtouchEnd()}};function b(){var t=this,e=(t.deviceRadio,t.width),o=t.height,n=t.cut,i=n.x,c=void 0===i?0:i,r=n.y,a=void 0===r?0:r,u=n.width,s=void 0===u?e:u,l=n.height,d=void 0===l?o:l;t.outsideBound=function(e,o){t.imgLeft=e>=c?c:t.scaleWidth+e-c<=s?c+s-t.scaleWidth:e,t.imgTop=o>=a?a:t.scaleHeight+o-a<=d?a+d-t.scaleHeight:o},t.setBoundStyle=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.color,r=void 0===i?"#04b00f":i,u=n.mask,l=void 0===u?"rgba(0, 0, 0, 0.3)":u,f=n.lineWidth,h=void 0===f?1:f;t.ctx.beginPath(),t.ctx.setFillStyle(l),t.ctx.fillRect(0,0,c,o),t.ctx.fillRect(c,0,s,a),t.ctx.fillRect(c,a+d,s,o-a-d),t.ctx.fillRect(c+s,0,e-c-s,o),t.ctx.fill(),t.ctx.beginPath(),t.ctx.setStrokeStyle(r),t.ctx.setLineWidth(h),t.ctx.moveTo(c-h,a+10-h),t.ctx.lineTo(c-h,a-h),t.ctx.lineTo(c+10-h,a-h),t.ctx.stroke(),t.ctx.beginPath(),t.ctx.setStrokeStyle(r),t.ctx.setLineWidth(h),t.ctx.moveTo(c-h,a+d-10+h),t.ctx.lineTo(c-h,a+d+h),t.ctx.lineTo(c+10-h,a+d+h),t.ctx.stroke(),t.ctx.beginPath(),t.ctx.setStrokeStyle(r),t.ctx.setLineWidth(h),t.ctx.moveTo(c+s-10+h,a-h),t.ctx.lineTo(c+s+h,a-h),t.ctx.lineTo(c+s+h,a+10-h),t.ctx.stroke(),t.ctx.beginPath(),t.ctx.setStrokeStyle(r),t.ctx.setLineWidth(h),t.ctx.moveTo(c+s+h,a+d-10+h),t.ctx.lineTo(c+s+h,a+d+h),t.ctx.lineTo(c+s-10+h,a+d+h),t.ctx.stroke()}}var y="1.1.4",w=function(){function t(e){a(this,t);var o=this,n={};return c(o,d),Object.keys(d).forEach(function(t){n[t]=d[t].default}),Object.assign(o,n,e),o.prepare(),o.attachPage(),o.createCtx(),o.observer(),o.cutt(),o.methods(),o.init(),o.update(),o}return u(t,[{key:"init",value:function(){var t=this,e=t.src;return t.version=y,"function"===typeof t.onReady&&t.onReady(t.ctx,t),e&&t.pushOrign(e),i(t,!1,!1,!1),t.oldScale=1,t.newScale=1,t}}]),t}();return Object.assign(w.prototype,v),w.prototype.prepare=f,w.prototype.observer=h,w.prototype.methods=p,w.prototype.cutt=b,w.prototype.update=g,w})}).call(this,o("6e42")["default"])},a98c:function(t,e,o){"use strict";o.r(e);var n=o("bb18"),i=o("b402");for(var c in i)"default"!==c&&function(t){o.d(e,t,function(){return i[t]})}(c);o("01dd");var r=o("2877"),a=Object(r["a"])(i["default"],n["a"],n["b"],!1,null,null,null);e["default"]=a.exports},b402:function(t,e,o){"use strict";o.r(e);var n=o("c1af"),i=o.n(n);for(var c in n)"default"!==c&&function(t){o.d(e,t,function(){return n[t]})}(c);e["default"]=i.a},bb18:function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("view",{staticClass:"content"},[o("view",{staticClass:"cropper-wrapper",staticStyle:{height:"617px"}},[o("canvas",{staticClass:"cropper",style:{width:t.cropperOpt.width,height:t.cropperOpt.height},attrs:{"disable-scroll":"true","canvas-id":"cropper",eventid:"5f0ac9fd-0"},on:{touchstart:t.touchStart,touchmove:t.touchMove,touchend:t.touchEnd}})]),o("view",{staticClass:"cropper-buttons"},[o("view",{staticClass:"upload",attrs:{eventid:"5f0ac9fd-1"},on:{tap:t.uploadTap}},[t._v("Browse Album")]),o("view",{staticClass:"getCropperImage",attrs:{eventid:"5f0ac9fd-2"},on:{tap:t.getCropperImage}},[t._v("Confirm")])])])},i=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return i})},c1af:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(o("697e"));function i(t){return t&&t.__esModule?t:{default:t}}var c=t.getSystemInfoSync(),r=c.windowWidth,a=c.windowHeight-50;console.log(c);var u={data:function(){return{cropperOpt:{id:"cropper",width:r,height:a,scale:2.5,zoom:8,cut:{x:(r-295)/2,y:(a-413)/2,width:295,height:413}},weCropper:""}},methods:{back:function(){t.redirectTo({url:"../infoDetail/infoDetail"})},touchStart:function(t){this.weCropper.touchStart(t)},touchMove:function(t){this.weCropper.touchMove(t)},touchEnd:function(t){this.weCropper.touchEnd(t)},convertBase64UrlToBlob:function(t,e){for(var o=atob(t.split(",")[1]),n=[],i=0;i<o.length;i++)n.push(o.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:e},{filename:"1111.jpg"})},blobToDataURL:function(t){var e=new FileReader;e.readAsDataURL(t),e.onload=function(t){var e=t.target.result;console.log(e)}},getCropperImage:function(){var e=this.getGlobalUserInfo();if(null!=e&&void 0!=e&&""!=e){var o=this;this.weCropper.getCropperImage(function(n){n?(t.uploadFile({url:o.$serverUrl+"/user/uploadFace?userId="+e.id,filePath:o.cropperOpt.src,name:"file",header:{"content-type":"application/json",userId:e.id,userToken:e.userToken},success:function(e){console.log(e);var n=JSON.parse(e.data);if(t.hideLoading(),200==n.status){t.showToast({title:"Success!",icon:"success"});var i=n.data;o.faceUrl=o.$serverUrl+i}else t.showToast({title:n.msg})}}),t.switchTab({url:"../profile/profile"})):console.log("获取图片失败，请稍后重试")})}else t.navigateTo({url:"../login/login"})},uploadTap:function(){var e=this;t.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){var o=t.tempFilePaths[0];e.weCropper.pushOrign(o)}})}},onLoad:function(e){var o=this.cropperOpt,i=e.src;i&&(Object.assign(o,{src:i}),this.weCropper=new n.default(o).on("ready",function(t){}).on("beforeImageLoad",function(e){t.showToast({title:"上传中",icon:"loading",duration:3e3})}).on("imageLoad",function(e){t.hideToast()})),console.log(this.cropperOpt.src)}};e.default=u}).call(this,o("6e42")["default"])},dab6:function(t,e,o){}},[["242a","common/runtime","common/vendor"]]]);